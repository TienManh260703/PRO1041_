CREATE DATABASE UPDATE1
GO
USE UPDATE1
GO

---- MAU
	CREATE TABLE MAU (
		ID_MAU BIGINT IDENTITY(1,1 )PRIMARY KEY NOT NULL,
		MA_MAU NVARCHAR(256) NOT NULL,
		TEN_MAU NVARCHAR(256) NOT NULL
	)

	INSERT INTO MAU (MA_MAU, TEN_MAU) VALUES
	('M1', N'Màu đen'),
	('M2', N'Màu trắng'),
	('M3', N'Màu đỏ'),
	('M4', N'Màu xanh'),
	('M5', N'Màu vàng');

	---- THUONG HIEU
	CREATE TABLE  THUONG_HIEU( 
		ID_THUONGHIEU BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_THUONGHIEU NVARCHAR(256) NOT NULL,
		TEN_THUONGHIEU NVARCHAR(256) NOT NULL
	)

	INSERT INTO THUONG_HIEU (MA_THUONGHIEU, TEN_THUONGHIEU) VALUES
	('TH_1', 'Reebok'),
	('TH_2', 'Vans'),
	('TH_3', 'Converse'),
	('TH_4', 'Under Armour'),
	('TH_5', 'New Balance');

	---- SIZE 

	CREATE TABLE SIZE(
		ID_SIZE BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_SIZE NVARCHAR(256) NOT NULL,
		KICHCO_SIZE FLOAT NOT NULL
	)

	INSERT INTO SIZE (MA_SIZE, KICHCO_SIZE) VALUES
	('S_1', 38),
	('S_2', 40),
	('S_3', 42),
	('S_4', 44),
	('S_5', 46);
	---- SAN PHAM

	CREATE TABLE SANPHAM(
		ID_SANPHAM BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_SANPHAM VARCHAR(256) NOT NULL,
		TEN_SANPHAM NVARCHAR(256) NOT NULL,
		MOTA_SANPHAM NVARCHAR(256) ,
		TRANGTHAI_SANPHAM BIT NOT NULL
	)

	INSERT INTO SANPHAM (MA_SANPHAM, TEN_SANPHAM, MOTA_SANPHAM, TRANGTHAI_SANPHAM) VALUES
	('SP1', N'Nike Air Max 270', N'Giày sneaker chạy bộ thoải mái', 1),
	('SP2', N'Adidas Superstar', N'Giày sneaker phong cách thể thao', 0),
	('SP3', N'Puma RS-X', N'Thiết kế độc đáo và hiện đại', 1),
	('SP4', N'Converse Chuck Taylor All Star', N'Classic và phổ biến', 1),
	('SP5', N'Vans Old Skool', N'Phối màu và kiểu dáng độc đáo', 0);


	---- NHAN VIEN

	CREATE TABLE NHANVIEN (
		ID_NHANVIEN BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL ,
		MA_NHANVIEN VARCHAR(256) NOT NULL,
		TEN_NHANVIEN NVARCHAR(256) NOT NULL,
		MATKHAU_NHANVIEN VARCHAR(256) NOT NULL,
		CCCD_NHANVIEN BIGINT NOT NULL,
		EMAIL_NHANVIEN VARCHAR(256) NOT NULL,
		SDT_NHANVIEN VARCHAR(256) NOT NULL,
		GIOITINH_NHANVIEN NVARCHAR(256) NOT NULL,
		DIACHI_NHANVIEN NVARCHAR(256) NOT NULL,
		ROLE_NHANVIEN BIT NOT NULL,
		TRANGTHAI_NHANVIEN NVARCHAR(50) NOT NULL
	)

	INSERT INTO NHANVIEN (MA_NHANVIEN, TEN_NHANVIEN, MATKHAU_NHANVIEN, CCCD_NHANVIEN, EMAIL_NHANVIEN, SDT_NHANVIEN, GIOITINH_NHANVIEN, DIACHI_NHANVIEN, ROLE_NHANVIEN, TRANGTHAI_NHANVIEN) VALUES
	('NV101', N'Nguyễn Thị Hương', 'mkh123', 123456789, 'huong@gmail.com', '0123456789', N'Nữ', 'Hà Nội', 0, 'Đang làm việc'),
	('NV202', N'Trần Văn Minh', 'minh456', 987654321, 'minh@gmail.com', '0987654321', N'Nam', 'Hồ Chí Minh', 0, 'Đang làm việc'),
	('NV303', N'Lê Anh Tuấn', 'tuan789', 456789012, 'tuan@gmail.com', '0345678901', N'Nam', 'Đà Nẵng', 0, 'Nghỉ làm'),
	('NV404', N'Phạm Thị Ngọc', 'ngoc987', 789012345, 'ngoc@gmail.com', '0765432109', N'Nữ', 'Hải Phòng', 0, 'Đang làm việc'),
	('NV505', N'Vũ Ngọc Tú', 'tu4321', 567890123, 'tuvu@gmail.com', '0890123456', N'Nam', 'Hòa Bình', 1, 'Đang làm việc');


---- KHÁCH HÀNG
	---- KHÁCH HÀNG
	CREATE TABLE KHACHHANG(
	ID_KHACHHANG BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL ,
	MA_KHACHANG VARCHAR(256) NOT NULL,
	TEN_KHACHHANG NVARCHAR(256) NOT NULL,
	SDT_KHACHHANG INT NOT NULL,
	--- UPDATE
	DIA_CHI NVARCHAR(250) NULL ,
	-- END UPDATE
	EMAIL_KHACHHANG VARCHAR(256) ,
	DIEM_KHACHHANG INT ,
	--- UPDATE
	CAP_BAC INT DEFAULT 0,
	-- END UPDATE
	NGAYTAO DATE NOT NULL,
	ID_NHANVIEN BIGINT FOREIGN KEY REFERENCES  NHANVIEN(ID_NHANVIEN)
	)

	INSERT INTO KHACHHANG (MA_KHACHANG, TEN_KHACHHANG, SDT_KHACHHANG,DIA_CHI, EMAIL_KHACHHANG, DIEM_KHACHHANG, NGAYTAO, ID_NHANVIEN) VALUES
	('KH001', N'Nguyễn Văn Khánh', 123456789, N'Hà Nội', 'khanhsa@gmail.com', 100, '2023-01-01', 1),
	('KH002', N'Trần Thị Lan', 987654321, N'Bắc Ninh', 'lan1da@gmail.com', 50, '2023-02-15', 2),
	('KH003', N'Lê Minh Tuấn', 456789012, N'Ninh Binh', 'tuan56fdg@gmail.com', 200, '2023-03-20', 3),
	('KH004', N'Phạm Thị Ngọc Anh', 789012345, N'HCM', 'anh3ghg@gmail.com', 75, '2023-04-10', 1),
	('KH005', N'Đỗ Quang Hải', 567890123, N'Vĩnh Phúc', 'hai3sdgf@gmail.com', 150, '2023-05-05', 2);

---- Sản Phẩm Chi Tiết
	CREATE TABLE SANPHAM_CHITIET (
		ID_SANPHAMCT BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_SANPHAMCT VARCHAR(256) NOT NULL,
		GIANIEMYET_SANPHAMCT FLOAT NOT NULL,
		GIABAN_SANPHAMCT FLOAT NOT NULL,
		SOLUONG_SOLUONG INT NOT NULL,
		IMG_SANPHAMCT VARCHAR(500) NOT NULL,
		TRANGTHAI_SANPHAMCT BIT NOT NULL,
		ID_THUONGHIEU BIGINT  FOREIGN KEY REFERENCES THUONG_HIEU(ID_THUONGHIEU),
		ID_MAU BIGINT  FOREIGN KEY REFERENCES MAU(ID_MAU),
		ID_SIZE BIGINT  FOREIGN KEY REFERENCES SIZE(ID_SIZE),
		ID_SANPHAM BIGINT  FOREIGN KEY REFERENCES SANPHAM(ID_SANPHAM),
		ID_NHANVIEN BIGINT  FOREIGN KEY REFERENCES NHANVIEN (ID_NHANVIEN)
	)

	INSERT INTO SANPHAM_CHITIET (MA_SANPHAMCT, GIANIEMYET_SANPHAMCT, GIABAN_SANPHAMCT, SOLUONG_SOLUONG, IMG_SANPHAMCT, TRANGTHAI_SANPHAMCT, ID_THUONGHIEU, ID_MAU, ID_SIZE, ID_SANPHAM, ID_NHANVIEN) VALUES
	('SPCT001', 1000000, 1500000, 50, 'img/sp1.jpg', 1, 1, 1, 1, 1, 5),
	('SPCT002', 1200000, 1800000, 30, 'img/sp2.jpg', 1, 2, 2, 2, 2, 5),
	('SPCT003', 900000, 1300000, 40, 'img/sp3.jpg', 1, 3, 3, 3, 3, 5),
	('SPCT004', 800000, 1200000, 25, 'img/sp4.jpg', 1, 4, 4, 4, 4, 5),
	('SPCT005', 1500000, 2000000, 35, 'img/sp5.jpg', 1, 5, 5, 5, 5, 5);


---- Phiếu giảm giá

	CREATE TABLE PHIEUGIAMGIA (
		ID_PHIEUGIAMGIA BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_PHIEUGIAMGIA VARCHAR(256) NOT NULL,
		TEN_PHIEUGIAMGIA NVARCHAR(256) NOT NULL,
		SOLUONG_PHIEUGIAMGIA INT NOT NULL,
		GIAMTHEO_PHIEUGIAMGIA NVARCHAR(256) NOT NULL,
		GIATRI_PHIEUGIAMGIA FLOAT NOT NULL,
		NGAYBATDAU_PHIEUGIAMGIA DATE NOT NULL,
		NGAYKETTHUC_PHIEUGIAMGIA DATE NOT NULL,
		MOTA_PHIEUGIAMGIA NVARCHAR(500),
		TRANGTHAI_PHIEUGIAMGIA BIT NOT NULL,
	)

	INSERT INTO PHIEUGIAMGIA (MA_PHIEUGIAMGIA, TEN_PHIEUGIAMGIA, SOLUONG_PHIEUGIAMGIA, NGAYBATDAU_PHIEUGIAMGIA, NGAYKETTHUC_PHIEUGIAMGIA, MOTA_PHIEUGIAMGIA, TRANGTHAI_PHIEUGIAMGIA) VALUES
	('PGG001', 'Giảm 10%', 50, N'Hóa Đơn',2000,'2023-01-01', '2023-02-01', 'Giảm giá 10% cho các sản phẩm giày sneaker', 1),
	('PGG002', 'Giảm 20%', 30, N'Hóa Đơn',4000,'2023-02-15', '2023-03-15', 'Giảm giá 20% cho các sản phẩm giày sneaker', 1),
	('PGG003', 'Giảm 15%', 40, N'Hóa Đơn',5000,'2023-03-20', '2023-04-20', 'Giảm giá 15% cho các sản phẩm giày sneaker', 1),
	('PGG004', 'Giảm 25%', 25, N'Hóa Đơn',6000,'2023-04-10', '2023-05-10', 'Giảm giá 25% cho các sản phẩm giày sneaker', 1),
	('PGG005', 'Giảm 30%', 35, N'Hóa Đơn',7000,'2023-05-05', '2023-06-05', 'Giảm giá 30% cho các sản phẩm giày sneaker', 1);

---- PhieuGG_SP

	CREATE TABLE PHIEUGG_SP (
		ID_PHIEUGG_SP BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		ID_PHIEUGIAMGIA BIGINT  FOREIGN KEY REFERENCES PHIEUGIAMGIA (ID_PHIEUGIAMGIA),
		ID_SANPHAMCT BIGINT  FOREIGN KEY REFERENCES SANPHAM_CHITIET (ID_SANPHAMCT)
	)

	INSERT INTO PHIEUGG_SP (ID_PHIEUGIAMGIA, ID_SANPHAMCT) VALUES 
	('1','5'),('2','4'),('3','3'),('4','2'),('5','1')


---- Dợt giảm giá 

	CREATE TABLE DOTGIAMGIA (
		ID_DOTGIAMGIA BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_DOTGIAMGIA VARCHAR(256) NOT NULL,
		TEN_DOTGIAMGIA NVARCHAR(256) NOT NULL,
		GIAMGIATHEO_DOTGIAMGIA  NVARCHAR(50) NOT NULL,
		GIATRI_DOTGIAMGIA  INT NOT NULL,
		NGAYBATDAU_DOTGIAMGIA  DATE NOT NULL,
		NGAYKETTHUC_DOTGIAMGIA  DATE NOT NULL,
		TRANGTHAI_DOTGIAMGIA BIT NOT NULL
	)

		INSERT INTO DOTGIAMGIA (MA_DOTGIAMGIA, TEN_DOTGIAMGIA, GIAMGIATHEO_DOTGIAMGIA, GIATRI_DOTGIAMGIA, NGAYBATDAU_DOTGIAMGIA, NGAYKETTHUC_DOTGIAMGIA, TRANGTHAI_DOTGIAMGIA) VALUES
	('DG001', 'Đợt Giảm Giá Mùa Hè', 'Phần trăm', 20, '2023-06-01', '2023-06-30', 1),
	('DG002', 'Đợt Giảm Giá Back to School', 'Số tiền', 50000, '2023-08-01', '2023-08-31', 1),
	('DG003', 'Đợt Giảm Giá Black Friday', 'Phần trăm', 30, '2023-11-24', '2023-11-27', 1),
	('DG004', 'Đợt Giảm Giá Giáng Sinh', 'Số tiền', 100000, '2023-12-01', '2023-12-31', 1),
	('DG005', 'Đợt Giảm Giá Tết Nguyên Đán', 'Phần trăm', 25, '2024-01-20', '2024-02-05', 1);


	CREATE TABLE DOTGIAMGIA_SANPHAM (
		ID_DGG_SP BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		ID_DOTGIAMGIA BIGINT FOREIGN KEY REFERENCES DOTGIAMGIA (ID_DOTGIAMGIA),
		ID_SP BIGINT FOREIGN KEY REFERENCES SANPHAM(ID_SANPHAM)
	)

	INSERT INTO DOTGIAMGIA_SANPHAM (ID_DOTGIAMGIA,ID_SP) VALUES (1,2), (3,4),(2,3),(5,4),(3,5)
---- PHIEU GIAO 

	CREATE TABLE PHIEUGIAO (
		ID_PHIEUGIAO BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_PHIEUGIAO VARCHAR(256) NOT NULL,
		TENNGUOINHAN_PHIEUGIAO NVARCHAR(256) NOT NULL,
		SDTNGUOINHAN_PHIEUGIAO BIGINT NOT NULL,
		DIACHINGUOINHAN_PHIEUGIAO  NVARCHAR(500) NOT NULL,
		GIASHIP_PHIEUGIAO FLOAT NOT NULL,
		NGAYTAO_PHIEUGIAO DATE NOT NULL,
		MAVANDON_PHIEUGIAO  VARCHAR(256) NOT NULL,
		DONVIVANCHUYEN_PHIEUGIAO  NVARCHAR(256) NOT NULL,
		ID_KHACHHANG  BIGINT  FOREIGN KEY REFERENCES KHACHHANG(ID_KHACHHANG)
	)

	INSERT INTO PHIEUGIAO (MA_PHIEUGIAO, TENNGUOINHAN_PHIEUGIAO, SDTNGUOINHAN_PHIEUGIAO, DIACHINGUOINHAN_PHIEUGIAO, GIASHIP_PHIEUGIAO, NGAYTAO_PHIEUGIAO, MAVANDON_PHIEUGIAO, DONVIVANCHUYEN_PHIEUGIAO, ID_KHACHHANG) VALUES
	('PG001', 'Nguyễn Văn Khánh', 123456789, '123 Đường ABC, Quận 1, TP.HCM', 50000, '2023-01-01', 'VD001', 'Viettel Post', 1),
	('PG002', 'Trần Thị Lan', 987654321, '456 Đường XYZ, Quận 2, TP.HCM', 60000, '2023-02-15', 'VD002', 'Giao Hàng Nhanh',2),
	('PG003', 'Lê Minh Tuấn', 456789012, '789 Đường LMN, Quận 3, TP.HCM', 70000, '2023-03-20', 'VD003', 'J&T Express', 3),
	('PG004', 'Phạm Thị Ngọc Anh', 789012345, '101 Đường PQR, Quận 4, TP.HCM', 55000, '2023-04-10', 'VD004', 'VNPost', 4),
	('PG005', 'Đỗ Quang Hải', 567890123, '202 Đường DEF, Quận 5, TP.HCM', 80000, '2023-05-05', 'VD005', 'Giao Hàng Tiết Kiệm', 5);

	CREATE TABLE PHIEUGIAO_SANPHAM (
		ID_PHIEUGIAOSP BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		ID_SANPHAMCT BIGINT  FOREIGN KEY REFERENCES SANPHAM_CHITIET (ID_SANPHAMCT),
		ID_PHIEUGIAO BIGINT  FOREIGN KEY REFERENCES PHIEUGIAO(ID_PHIEUGIAO),
		SOLUONG INT NOT NULL
	)


	-- Thêm vào bảng PHIEUGIAO_SANPHAM
INSERT INTO PHIEUGIAO_SANPHAM (ID_SANPHAMCT, ID_PHIEUGIAO, SOLUONG) VALUES
(1, 1, 2),
(2, 2, 3),
(3, 3, 4),
(4, 4, 2),
(5, 5, 5);
---- HOA DON


	CREATE TABLE HOADON (
		ID_HOADON BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
		MA_HOADON VARCHAR(256) NOT NULL,
		NGAYTAO_HOADON  DATE NOT NULL,
		PHUONGTHUC_HOADON  NVARCHAR(256) NOT NULL,
		TONGTIEN_HOADON  FLOAT NOT NULL,
		DIEMDOI_HOADON  INT NOT NULL,
		TIENPHAITRA_HOADON  FLOAT NOT NULL,
		TRANGTHAI BIT NOT NULL,
		ID_DOTGIAMGIA BIGINT FOREIGN KEY REFERENCES DOTGIAMGIA (ID_DOTGIAMGIA) NULL,
		ID_PHIEUGIAMGIA BIGINT  FOREIGN KEY REFERENCES PHIEUGIAMGIA (ID_PHIEUGIAMGIA) NULL,
		ID_KHACHHANG  BIGINT  FOREIGN KEY REFERENCES KHACHHANG(ID_KHACHHANG),
		ID_PHIEUGIAO BIGINT  FOREIGN KEY REFERENCES PHIEUGIAO(ID_PHIEUGIAO) NULL,
		ID_NHANVIEN BIGINT  FOREIGN KEY REFERENCES NHANVIEN (ID_NHANVIEN)
	)
		INSERT INTO HOADON (MA_HOADON, NGAYTAO_HOADON, PHUONGTHUC_HOADON, TONGTIEN_HOADON, DIEMDOI_HOADON, TIENPHAITRA_HOADON, TRANGTHAI, ID_DOTGIAMGIA, ID_PHIEUGIAMGIA, ID_KHACHHANG, ID_PHIEUGIAO, ID_NHANVIEN) VALUES
	('HD001', '2023-01-15', 'Chuyển khoản', 1500000, 50, 750000, 1, 1, 1,1, 1,1),
	('HD002', '2023-02-28', 'Tiền mặt', 1200000, 40, 720000, 1, 2, 2, 2, 2, 2),
	('HD003', '2023-03-15', 'Chuyển khoản', 1800000, 60, 900000, 1, 3,3, 3,3,3),
	('HD004', '2023-04-02', 'Tiền mặt', 1300000, 45, 715000, 1, 4, 4, 4,4, 4),
	('HD005', '2023-05-20', 'Chuyển khoản', 1600000, 55, 800000, 1, 5, 5,5,5,5);
---- HÓA ĐƠN CHI TIẾT 

CREATE TABLE HOADON_CHITIET (
	ID_HOADONCT BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	MA_HOADONCT VARCHAR(256) NOT NULL,
	SOLUONG INT NOT NULL,
	DONGIA  FLOAT NOT NULL,
	TONGGIAM FLOAT NOT NULL,
	THANHTIEN FLOAT NOT NULL,
	ID_HOADON BIGINT  FOREIGN KEY REFERENCES HOADON(ID_HOADON),
	ID_SANPHAMCT BIGINT  FOREIGN KEY REFERENCES SANPHAM_CHITIET (ID_SANPHAMCT)
)

INSERT INTO HOADON_CHITIET (MA_HOADONCT, SOLUONG, DONGIA, TONGGIAM, THANHTIEN, ID_HOADON, ID_SANPHAMCT) VALUES
('HDCT001', 2, 500000, 100000, 900000,1, 1),
('HDCT002', 3, 400000, 80000, 1120000, 2, 2),
('HDCT003', 4, 450000, 120000, 1680000, 3, 3),
('HDCT004', 2, 550000, 110000, 990000, 4, 4),
('HDCT005', 5, 600000, 150000, 2550000,5, 5);

--LỊCH SỬ 

CREATE TABLE LICHSU_GIAODICH (
	ID_LICHSU BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	MA_LICHSU VARCHAR(256) NOT NULL,
	NGAYGIAODICH_LICHSU DATE NOT NULL,
	TIENNHAN_LICHSU FLOAT NOT NULL,
	TIENTHUA_LICHSU FLOAT NOT NULL,
	PHUONGTHUCTT_LICHSU NVARCHAR(256) NOT NULL,
	TRANGTHAI_LICHSU BIT NOT NULL,
	ID_HOADON BIGINT  FOREIGN KEY REFERENCES HOADON(ID_HOADON),
	ID_KHACHHANG  BIGINT  FOREIGN KEY REFERENCES KHACHHANG(ID_KHACHHANG),
	ID_NHANVIEN BIGINT  FOREIGN KEY REFERENCES NHANVIEN (ID_NHANVIEN)	
)

INSERT INTO LICHSU_GIAODICH (MA_LICHSU, NGAYGIAODICH_LICHSU, TIENNHAN_LICHSU, TIENTHUA_LICHSU, PHUONGTHUCTT_LICHSU, TRANGTHAI_LICHSU, ID_HOADON, ID_KHACHHANG, ID_NHANVIEN) VALUES
('LSGD001', '2023-01-15', 800000, 50000, 'Chuyển khoản', 1, 1,1, 1),
('LSGD002', '2023-02-28', 1000000, 280000, 'Tiền mặt', 1, 2, 2,2),
('LSGD003', '2023-03-15', 1500000, 80000, 'Chuyển khoản', 1,3,3, 3),
('LSGD004', '2023-04-02', 1100000, 150000, 'Tiền mặt', 1, 4, 4, 4),
('LSGD005', '2023-05-20', 1200000, 40000, 'Chuyển khoản', 1, 5,5, 5);